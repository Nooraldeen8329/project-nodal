# task: zone-and-structure (2026-01-13)

- task004 [x] 定义并接入 Zone 数据结构与持久化（产出：新增 `canvas.zones` 与 `note.zoneId`；验证：`npm run build` 通过，打开应用创建 note 后刷新不报错；影响范围：`src/store/useStore.js`, `src/components/Canvas.jsx`）
- task005 [x] 实现 Zone MVP（创建/删除/移动/四角缩放）（产出：顶部按钮创建 Zone/子 Zone；选中显示四角把手；可拖拽移动/缩放/删除；验证：`npm run build` 通过，手动验证 A/B/C；影响范围：`src/components/Canvas.jsx`）
- task006 [x] 实现卡片归属（>50% 重叠、deepest wins、解除归属）（产出：拖拽结束后自动写入 `note.zoneId`；拖拽中高亮候选 zone；验证：`npm run build` 通过，手动验证拖入/拖出符合 >50% 规则；影响范围：`src/components/Canvas.jsx`, `src/components/StickyNote.jsx`）
- task007 [x] 实现 overflow 推回（zone 变换时卡片不越界）（产出：Zone 移动时带动 subtree zones 与归属卡片一起移动；Zone resize 时将归属卡片 clamp 回 Zone 内；验证：`npm run build` 通过，手动缩放 Zone 不会把归属卡片留在边界外；影响范围：`src/components/Canvas.jsx`）
- task008 [x] 背景图缩放鼠标角把手（产出：选中背景图后显示四角把手并可拖拽缩放；同时持久化 `backgroundTransform`；验证：`npm run build` 通过，手动复现 issue002 场景可缩放；影响范围：`src/components/Canvas.jsx`, `src/store/useStore.js`）
- task009 [x] 绘制语义模型扩展点（数据结构/序列化）（产出：新增 `canvas.schemaVersion` 与 `canvas.sceneGraph`；补齐 tech-refer 的 Decision 与迁移策略；验证：`npm run build` 通过；影响范围：`src/store/useStore.js`, `.phrase/phases/phase-zone-and-structure-20260113/spec_zone_and_structure_20260113.md`, `.phrase/phases/phase-zone-and-structure-20260113/tech-refer_zone_and_structure_20260113.md`）
- task010 [x] 修复 issue005 页面空白（产出：避免 build 后 TDZ 崩溃；验证：`npm run build` 通过，浏览器不再报 `Cannot access 'Sn' before initialization`；影响范围：`src/components/Canvas.jsx`）
- task011 [x] 修复 issue006 Zone move 误带已解除归属卡片（产出：Zone move 每帧只移动 `zoneId` 仍归属的卡片；验证：`npm run build` 通过，手动：卡片拖出 Zone 后拖拽 Zone，卡片不再跟随；影响范围：`src/components/Canvas.jsx`，`.phrase/docs/ISSUES.md`，`.phrase/phases/phase-zone-and-structure-20260113/issues/issue006_zone_and_structure_20260113.md`）
- task012 [x] 修复 issue007 拖拽 Zone 边框误触发 PAN（产出：Zone 边框可稳定触发 `ZONE_MOVE` 且 HUD `viewport.x/y` 不变；验证：`npm run build` 通过，手动：拖拽 Zone 边框不再改 viewport；影响范围：`src/components/Canvas.jsx`，`.phrase/docs/ISSUES.md`，`.phrase/phases/phase-zone-and-structure-20260113/issues/issue007_zone_and_structure_20260113.md`）
- task013 [x] 提升 Zone 边框拖拽易用性（产出：边框可拖拽命中区域扩大且主要位于 Zone 外侧；验证：`npm run build` 通过，手动：更容易抓住边框拖拽且不影响 Zone 内部 PAN/绘制；影响范围：`src/components/Canvas.jsx`，`.phrase/phases/phase-zone-and-structure-20260113/issues/issue007_zone_and_structure_20260113.md`）
- task014 [x] 清理绘制/白板尝试代码（tldraw/excalidraw remnants）并移除画形状功能（产出：移除绘制工具栏与 SVG 绘制层，删掉 `Canvas.backup.jsx`/`Canvas.excalidraw_attempt.jsx`/`RoughShape.jsx`，并在 store 归一化时移除 `drawings/excalidrawElements` 字段；验证：`npm run build` 通过，手动：工具栏不再出现 shape/text/eraser，画布仍可 Pan/Zoom，Zone/Note/背景图功能正常；影响范围：`src/components/Canvas.jsx`, `src/store/useStore.js`, `package.json`, `package-lock.json`）
- task015 [x] 修复 issue008 Zone 渲染问题：统一边框为单容器（产出：Zone 使用单 div + border 渲染，点击内部可选中；验证：`npm run build` 通过，手动拖拽 Zone 中心可移动；影响范围：`src/components/Canvas.jsx`）
